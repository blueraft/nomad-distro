# Tutorial for parsing data from atom probe microscopy

## Scope
This example combines a set of configured components of NOMAD
to collect metadata specific for atom probe and combine these with
reconstructed and ranged atom probe datasets available in different
domain-specific file formats. Specifically, the tutorial shows how
functionalities of a NOMAD electronic lab notebook (ELN) instance
customized for atom probe, the `apm` dataconverter offered through
the `pynxtools` NeXus parser, the `NXapm` NeXus data schema, and
several NOMAD core functionalities work together to create
atom-probe-domain-specific NOMAD entries with respective default
plots for `h5web`.

## Getting started
1. Click the respective button to execute the example.
2. Wait for NOMAD to instantiate the example for you.
3. Check that you are in the `Uploads` section (menu bar).
4. Select the generated upload.
5. Explore its content by clicking on the arrow keys (to the right side of a file).
6. Modify the input file in the NOMAD ELN to match your dataset.
   You can also use the drag-and-drop functionality to drop your
   reconstruction and ranging definition file inside the ELN and remove
   the example reconstruction and ranging file.
7. Click `save` to trigger a reprocessing of your upload which will
   update and reprocess the NeXus/HDF5 NXapm entries for you.
8. Explore its content via e.g. the preview or via the `Entries`
   (select from the menu bar).

## Which input is supported by this example?
This example works with the following community file formats (POS, ePOS, APT as
from AP Suite, and RNG, RRNG) which contain the tomographic reconstruction and
associated ranging definitions for interpreting ion species from mass-to-charge-state
ratio values respectively. Furthermore, there is support for simple text file based
ranging definitions to make also ranging definitions of e.g. Matlab figures parsable.
Matlab figure have to be converted into a text file representation of the ranging
definitions because a Matlab figure file cannot right now be interpreted by NOMAD).

The ELN is used to collect metadata which are currently not stored typically in
the reconstruction and ranging definitions. The ELN is configured in this example
to collect details about the specimen, the instrument, users, and some
post-processing steps. The `apm` reader analyses the charge states of the
iontypes.

## Which data artefacts should I expect to find?
This example upload contains the following entries:
- A schema in NOMAD's *archive.yaml* format: *nxapm.schema.archive.yaml*
- A schema instance file as used and generated by NOMAD *nxapm.archive.json*.
  For educational purposes this file is filled with values but it is the
  user's responsibility to check that these metadata match their dataset.
- Another schema instance file *eln_data.yaml*. This file contains a plain
  view of all entered/modified quantities including their units. This file is
  updated with clicking the `save` button. This file should not be edited
  manually. Instead, edit the schema instance using the NOMAD GUI.
- Another schema instance file *apm.oasis.specific.yaml*. This file contains
  metadata that for specific local NOMAD OASIS installations should become
  overwritten to reduce the complexity of ELN templates.

## Which data schema is used?
Specifically the ELN template is configured such that its terminology matches to
the [NXapm](https://fairmat-nfdi.github.io/nexus-fairmat-proposal) NeXus data schema.

## Acknowledgements
This example comes with real world dataset which were measured and characterized
by members of the international atom probe community.
[Details can be found here:](https://www.zenodo.org/record/7908429#.ZFt6Ds5By38)

## Where to raise questions, comments, and suggestions?
You are very welcome to approach us with all sorts of questions, and
feature requests. [Markus Kühbach](https://www.fairmat-nfdi.eu/fairmat/about-fairmat/team-fairmat)
is the respective contact person within the FAIRmat consortium.
Feel free and [create a GitHub issue](https://github.com/FAIRmat-NFDI/pynxtools) to point us to
specific questions, experiences, or problems.

## Where to go from now?
Provided the upload was successful and your NOMAD OASIS is using a working JupyterHub
configuration, you can also work, i.e. analyze your atom probe data using NOMAD via the
apmtools container. For this your NOMAD OASIS instance needs a working JupyterHub and
has to be configured to include the NOMAD Remote Tools Hub `north`.

For this you should go to `Analytics` (menu bar) and select the `NOMAD Remote Tools Hub`
(NORTH). This service and toolset of NOMAD offers a set of preconfigured containers.
As a first example of the possibilities, we have configured the `apmtools` container.

Currently, `apmtools` is a specific docker container with a graphical user interface
which is accessible via your browser. The container includes three data analysis tools:
- [aptyzer](https://github.com/areichm/APTyzer) by Alexander Reichmann et al.
- [paraprobe-toolbox](https://gitlab.com/paraprobe/paraprobe-toolbox) by Markus Kühbach et al.
- [apav](https://gitlab.com/jesseds/apav) by Jesse Smith et al.

The container is configured such that the data in your uploads are available via the
`/config/uploads` sub-directory from within the container. Thereby, you can move data
in between the container and the upload section to enrich your upload with specific
post-processing results generated by any of the tools in the container.

The `apmtools` container comes with a collection of getting started tutorials
via a `Cheatsheet` jupyter notebook which you can access from the `/home/atom_probe_tools`
sub-directory.

Details dependent on the specific configuration of your NOMAD OASIS.

## Where to find examples for data schemas of post-processing atom probe data?
Specifically the tutorials for the paraprobe-toolbox inside the `apmtools`
container show you how post-processing of atom probe data can also be documented
using NeXus. [For this we refer to the NXapm_paraprobe-specific examples.](https://fairmat-nfdi.github.io/nexus-fairmat-proposal/)
